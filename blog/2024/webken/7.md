---
title: "【第7回】簡単なWebアプリを作ってみよう"
description: "Webフレームワークを使ってTODOアプリを作ります"
date: "2024-06-24"
authors: ["batora9"]
tags: ["Web研究会", "Webアプリケーション", "Hono"]
prev: "./6"
---

## 今回やること

今回は、Honoというフレームワークを使って、前回作ったTODOアプリを簡単に書き直してみましょう。

## Honoを使ってみる

まずは、前回の作業ディレクトリ`simple-todo-app`に移動します。

Honoを使うために`package.json`を編集します。

```json:package.json{4-10}
{
    "name": "simple-todo-app",
    "type": "module",
    "dependencies": {
    "@hono/node-server": "^1.11.1",
    "hono": "^4.3.6"
    },
    "scripts": {
    "start": "node server.js"
    }
}
```

次に、npmで`package.json`を読み込み、必要なパッケージをインストールします。

```bash
npm install
```

`package-lock.json`と`node_modules`ディレクトリが生成されたら、`server.js`を編集します。

```js:server.js
import { serve } from "@hono/node-server";
import { Hono } from "hono";

const app = new Hono();

let todoList = [
  // idでTODOを管理する
  { id: "1", title: "JavaScriptを勉強する", completed: false },
  { id: "2", title: "TODOアプリを自作する", completed: false },
  { id: "3", title: "漫画を読み切る", completed: true },
  { id: "4", title: "ゲームをクリアする", completed: false },
];

app.get("/", (c) => c.json(todoList));

app.post("/", async (c) => {
  const param = await c.req.json();
  const newTodo = {
    id: String(todoList.length + 1),
    completed: false,
    title: param.title,
  };
  todoList = [...todoList, newTodo];

  return c.json(newTodo, 201);
});

serve({
  fetch: app.fetch,
  port: 8000,
});
```

## TODOの編集・削除機能を追加しよう

```js:server.js
import { serve } from "@hono/node-server";
import { Hono } from "hono";

const app = new Hono();

let todoList = [
  { id: "1", title: "JavaScriptを勉強する", completed: false },
  { id: "2", title: "TODOアプリを自作する", completed: false },
  { id: "3", title: "漫画を読み切る", completed: true },
  { id: "4", title: "ゲームをクリアする", completed: false },
];

app.get("/", (c) => c.json(todoList));

// TODOの追加
app.post("/", async (c) => {
  const param = await c.req.json();
  const newTodo = {
    id: String(Number(todoList.length === 0 ? "1" : todoList[todoList.length - 1].id) + 1),
    completed: false,
    title: param.title,
  };
  todoList = [...todoList, newTodo];

  return c.json(newTodo, 201);
});

// TODOの編集
app.put("/:id", async (c) => {
  const id = c.req.param("id");
  const todo = todoList.find((todo) => todo.id === id);
  if (!todo) {
    return c.json({ message: "not found" }, 404);
  }
  const param = await c.req.json();
  todo.title = param.title || todo.title;
  todo.completed = param.completed !== undefined ? param.completed : todo.completed;
  return c.json(null, 204);
});

// TODOの削除
app.delete("/:id", async (c) => {
  const id = c.req.param("id");
  const todo = todoList.find((todo) => todo.id === id);
  if (!todo) {
    return c.json({ message: "not found" }, 404);
  }
  todoList = todoList.filter((todo) => todo.id !== id);

  return c.json(null, 204);
});

serve({
  fetch: app.fetch,
  port: 8000,
});
```

### コマンドでTODO項目を操作してみよう

まず、サーバーを起動します。

```bash
npm start &
```

以下のコマンドを実行してみましょう。

- TODOの追加コマンド

以下のコマンドで、新しいTODOを追加します。

```bash
curl -o /dev/null -w "%{http_code}\n" -s -X POST -H "Content-Type: application/json" -d '{"title": "次回のWeb研に出席する"}' http://localhost:8000
```

- TODOの編集コマンド

以下のコマンドで、`id`が1のTODOを完了済みに変更します。

```bash
curl -o /dev/null -w "%{http_code}\n" -s -X PUT -H "Content-Type: application/json" -d '{"completed": true}' http://localhost:8000/2
```

以下のコマンドで、`id`が1のTODOのタイトルを「Node.jsを勉強する」に変更します。

```bash
curl -o /dev/null -w "%{http_code}\n" -s -X PUT -H "Content-Type: application/json" -d '{"title": "Node.jsを勉強する"}' http://localhost:8000/1
```

- TODOの削除コマンド

以下のコマンドで、`id`が3のTODOを削除します。

```bash
curl -o /dev/null -w "%{http_code}\n" -s -X DELETE http://localhost:8000/3
```

実際に動作することが確認出来たら、サーバーを切断してコミットしましょう。

```bash
git add .
git commit -m "TODOの編集・削除機能を追加"
```

## フロントとサーバーを連携してみよう

新しい作業ディレクトリ`hono-todo-app`を作成し、その中に`server`ディレクトリと`client`ディレクトリを作成します。

下のようにディレクトリ構造を作成します。

```text
hono-todo-app
├── client
└── server
```

### フロント側の実装

`client`ディレクトリに移動し、`index.html`と`script.js`を作成します。

```text
hono-todo-app
├── client
│   ├── index.html
│   └── script.js
└── server
```

`index.html`と`script.js`を以下のように編集します。

```html:index.html
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>TODOアプリ</title>
  </head>
  <body>
    <h1>連携テスト</h1>
    <button id="fetch">データ取得</button>
    <div id="output"></div>
    <script src="./script.js"></script>
  </body>
</html>
```

```js:script.js
const fetchButton = document.getElementById("fetch");
const output = document.getElementById("output");

// ボタンがクリックされたときの処理
fetchButton.addEventListener("click", async () => {
  // サーバーにリクエストを送信する
  const response = await fetch("http://localhost:8000");
  // レスポンスの内容を取得する
  console.log(response);
  // レスポンスの内容をテキストとして取得する
  const data = await response.text();
  // レスポンスの内容を出力する
  output.innerHTML = data;
});
```

### サーバー側の実装

`server`ディレクトリに移動し、`package.json`と`server.js`を作成します。

```text
hono-todo-app
├── client
│   ├── index.html
│   └── script.js
└── server
    ├── package.json
    └── server.js
```

`package.json`と`server.js`を以下のように編集します。

```json:package.json
{
  "name": "hono-todo-app",
  "type": "module",
  "dependencies": {
    "@hono/node-server": "^1.11.1",
    "hono": "^4.3.6"
  },
  "scripts": {
    "start": "node server.js"
  }
}
```

```js:server.js
import { serve } from "@hono/node-server";
import { Hono } from "hono";
import { cors } from "hono/cors";

const app = new Hono();

// CORSの設定
app.use(
  "*",
  cors({
    origin: "null",
  })
);

// ルートパスにアクセスしたときの処理
app.get("/", (c) => {
  return c.text("Hello from Node.js server!");
});

// サーバーを起動する
serve({
  fetch: app.fetch,
  port: 8000,
});
```

### サーバーを起動してみよう

まず、必要なパッケージをインストールします。

```bash
npm install
```

次に、サーバーを起動します。

```bash
npm start
```

`index.html`をブラウザで開いて、ボタンをクリックしてみましょう。

![result1](/images/blog/2024/webken-7/result1.png)

「Hello from Node.js server!」と表示されました。

### ちょっとした解説

`index.html`を開いてボタンをクリックすると、テキストが表示されますがこれはどこから来たのでしょうか？

`script.js`の中で、`fetch`関数を使ってサーバー`http://localhost:8000`にリクエストを送信しています。

```js
const response = await fetch("http://localhost:8000");
```

`fetch`関数は、指定したURLにリクエストを送信し、レスポンスを返します。

`response`には、レスポンスの内容が入っています。

```js
const data = await response.text();
```

`response.text()`は、サーバーにアクセスしたときに返ってきたデータをテキストとして取得します。

つまり、クライアント(ブラウザ)がサーバーにリクエストを送信し、それに対するレスポンスを受け取ってブラウザに表示しているということです。
